{% extends 'base_template.html' %}

{% block title %}物品标签 - iStorage{% endblock %}

{% block content %}
<!-- 标签展示区域 -->
<div id="tag-display" class="w-[calc(9rem+20px)] mx-auto glass-card p-4 rounded-xl shadow-lg mb-4 border border-gray-200 bg-white text-center">
    <!-- 物品编号 -->
    <div class="text-4xl font-bold mb-2">#{{ item_code }}</div>
    
    <!-- 物品名称 -->
    <div class="text-2xl font-bold max-w-36 mx-auto break-words">{{ name|default:"未命名物品" }}</div>
</div>

<!-- 操作按钮区域 -->
<div class="w-[calc(9rem+20px)] mx-auto space-y-2">
    <button id="print-button" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">
        打印标签
    </button>
    <button id="back-button" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg transition-colors duration-200">
        返回录入
    </button>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // 打印标签功能
    document.getElementById('print-button').addEventListener('click', function() {
        window.print();
        
        // 打印后直接在当前页面显示成功提示，不刷新页面
        setTimeout(function() {
            // 检查是否已存在成功提示元素
            let alertElement = document.getElementById('print-success-alert');
            
            if (!alertElement) {
                // 创建成功提示元素
                alertElement = document.createElement('div');
                alertElement.id = 'print-success-alert';
                alertElement.className = 'bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-2 text-center animate-fade-in';
                alertElement.innerHTML = '<strong class="font-bold">打印成功！</strong>';
                
                // 插入到标签显示区域上方
                const tagDisplay = document.getElementById('tag-display');
                if (tagDisplay) {
                    tagDisplay.parentNode.insertBefore(alertElement, tagDisplay);
                }
            } else {
                // 如果已存在则显示它
                alertElement.style.display = 'block';
            }
            
            // 3秒后自动隐藏提示
            setTimeout(function() {
                if (alertElement) {
                    alertElement.style.display = 'none';
                }
            }, 3000);
        }, 500);
    });
    
    // 返回录入页面
    document.getElementById('back-button').addEventListener('click', function() {
        window.location.href = '{% url "items:item_create" %}';
    });
    
    // 仅打印标签部分
    window.onbeforeprint = function() {
        // 隐藏不需要打印的元素
        const buttons = document.querySelectorAll('button');
        const alert = document.getElementById('print-success-alert');
        const container = document.querySelector('.container');
        const glassCard = document.querySelector('.glass-card');
        const tagDisplay = document.getElementById('tag-display');
        const buttonContainer = document.querySelector('.space-y-2');
        
        // 隐藏所有非标签区域元素
        container.style.maxWidth = '300px';
        glassCard.style.padding = '0';
        glassCard.style.boxShadow = 'none';
        buttonContainer.style.display = 'none';
        
        // 确保标签区域内容居中且左右无间距
        tagDisplay.style.paddingLeft = '0';
        tagDisplay.style.paddingRight = '0';
        
        // 额外保险，确保所有按钮都隐藏
        buttons.forEach(btn => btn.style.display = 'none');
        if (alert) alert.style.display = 'none';
    };
    
    window.onafterprint = function() {
        // 恢复隐藏的元素
        const buttons = document.querySelectorAll('button');
        const alert = document.getElementById('print-success-alert');
        const container = document.querySelector('.container');
        const glassCard = document.querySelector('.glass-card');
        const tagDisplay = document.getElementById('tag-display');
        const buttonContainer = document.querySelector('.space-y-2');
        
        // 恢复样式
        container.style.maxWidth = '';
        glassCard.style.padding = '';
        glassCard.style.boxShadow = '';
        buttonContainer.style.display = '';
        
        // 恢复标签区域样式
        tagDisplay.style.paddingLeft = '';
        tagDisplay.style.paddingRight = '';
        
        // 恢复所有按钮
        buttons.forEach(btn => btn.style.display = '');
        if (alert) alert.style.display = '';
    };
</script>
{% endblock %}