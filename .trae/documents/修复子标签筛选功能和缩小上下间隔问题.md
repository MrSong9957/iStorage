## 问题分析

1. **子标签筛选功能未实现**：

   * 问题根源：分类标签的 `data-tag` 属性与物品组的 `data-group` 属性不匹配

   * 具体原因：

     * 物品组的 `data-group` 属性使用 `group_name|slugify`，其中 `group_name` 是 `item.category.name` 或 "未分类"

     * 分类标签的 `data-tag` 属性使用 `category|slugify`，其中 `category` 是 Category 对象，而不是字符串

     * 导致 `slugify` 过滤器对 Category 对象进行处理，而不是对 `category.name` 进行处理

   * 房间标签工作正常，因为 `all_rooms` 是字符串列表

2. **上下间隔未能实现**：

   * `find-layout` 类的 `gap` 值已修改为 `var(--spacing-sm)`

   * 但 `sidebar` 类有 `margin-bottom: var(--spacing-sm);` 设置

   * 需要进一步检查布局结构，确保间距缩小效果符合预期

## 修复方案

1. **修复子标签筛选功能**：

   * 修改 `sidebar.html` 中的分类标签生成代码，使用 `category.name|slugify` 而不是 `category|slugify`

   * 确保标签的 `data-tag` 属性与物品组的 `data-group` 属性完全匹配

2. **优化上下间隔**：

   * 检查 `find-layout` 类的布局结构

   * 确认 `flex-direction: column` 正确应用

   * 确保 `gap` 属性生效

## 修复代码

### 1. 修改 sidebar.html 中的分类标签生成代码

```html
<!-- 动态生成分类标签 -->
{% if filter_type == 'room' %}
    {% for room in all_rooms %}
        <li class="tag-item" data-tag="{{ room|slugify }}">
            <a href="#" class="tag-link">{{ room }}</a>
        </li>
    {% endfor %}
{% else %}
    {% for category in all_categories %}
        <li class="tag-item" data-tag="{{ category.name|slugify }}">
            <a href="#" class="tag-link">{{ category.name }}</a>
        </li>
    {% endfor %}
    <!-- 未分类标签 -->
    <li class="tag-item" data-tag="未分类|slugify">
        <a href="#" class="tag-link">未分类</a>
    </li>
{% endif %}
```

## 预期效果

1. **子标签筛选功能**：

   * 点击分类标签时，只显示该分类下的数据列表

   * 点击房间标签时，只显示该房间下的数据列表

   * 标签激活状态正确更新

2. **上下间隔**：

   * 侧边栏和主内容区之间的间距缩小为 `var(--spacing-sm)`

   * 符合苹果设计风格的极简主义

## 执行步骤

1. 修改 `sidebar.html` 中的分类标签生成代码，确保 `data-tag` 属性与物品组的 `data-group` 属性匹配
2. 运行 Django 开发服务器，测试子标签筛选功能
3. 检查侧边栏和主内容区之间的间距是否符合预期
4. 测试其他功能模块，确保修复不会影响其他功能

## 风险评估

* 低风险：仅修改了模板代码，未修改核心功能逻辑

* 对现有数据完全兼容，无需数据迁移

* 符合 Django 最佳实践

* 严格遵循苹果设计风格与极简主义原则

