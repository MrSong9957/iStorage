# ç»Ÿä¸€ä¾§è¾¹æ æ¨¡æ¿è®¾è®¡ä¸å®ç°

## 1. æ¨¡å‹è®¾è®¡

### 1.1 åˆ›å»ºå¯¼èˆªæ¨¡å‹

åˆ›å»º `Navigation` æ¨¡å‹æ¥ç®¡ç†ä¾§è¾¹æ çš„å¤§åˆ†ç±»å’Œå­æ ‡ç­¾ï¼š

```python
class Navigation(models.Model):
    """å¯¼èˆªæ¨¡å‹ï¼Œç”¨äºç®¡ç†ä¾§è¾¹æ çš„å¤§åˆ†ç±»å’Œå­æ ‡ç­¾"""
    # å¯¼èˆªç±»å‹ï¼šå¤§åˆ†ç±»æˆ–å­æ ‡ç­¾
    TYPE_CHOICES = [
        ('main', 'å¤§åˆ†ç±»'),
        ('sub', 'å­æ ‡ç­¾'),
    ]
    
    # å¯¼èˆªåç§°
    name = models.CharField(max_length=50, verbose_name='å¯¼èˆªåç§°')
    
    # å¯¼èˆªç±»å‹
    type = models.CharField(max_length=10, choices=TYPE_CHOICES, verbose_name='å¯¼èˆªç±»å‹')
    
    # çˆ¶çº§å¯¼èˆªï¼ˆä»…å­æ ‡ç­¾æœ‰ï¼‰
    parent = models.ForeignKey(
        'self', 
        on_delete=models.CASCADE, 
        null=True, 
        blank=True, 
        related_name='children', 
        verbose_name='çˆ¶çº§å¯¼èˆª'
    )
    
    # å¯¼èˆªé“¾æ¥
    url = models.CharField(max_length=200, verbose_name='å¯¼èˆªé“¾æ¥')
    
    # å›¾æ ‡
    icon = models.CharField(max_length=20, verbose_name='å¯¼èˆªå›¾æ ‡')
    
    # æ’åºé¡ºåº
    order = models.PositiveIntegerField(default=0, verbose_name='æ’åºé¡ºåº')
    
    # å…³è”åˆ°ç”¨æˆ·
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name='navigations', verbose_name='æ‰€å±ç”¨æˆ·')
    
    class Meta:
        verbose_name = 'å¯¼èˆª'
        verbose_name_plural = 'å¯¼èˆª'
        ordering = ['order', 'id']
        unique_together = (('user', 'name', 'type', 'parent'),)
```

### 1.2 æ•°æ®è¿ç§»

- è¿è¡Œ `python manage.py makemigrations` åˆ›å»ºæ•°æ®åº“è¿ç§»æ–‡ä»¶
- è¿è¡Œ `python manage.py migrate` æ‰§è¡Œæ•°æ®åº“è¿ç§»

## 2. æ¨¡æ¿è®¾è®¡

### 2.1 åˆ›å»ºç»Ÿä¸€ä¾§è¾¹æ æ¨¡æ¿ç‰‡æ®µ

åˆ›å»º `templates/items/sidebar.html` ä½œä¸ºç»Ÿä¸€çš„ä¾§è¾¹æ æ¨¡æ¿ç‰‡æ®µï¼š

```html
<aside class="sidebar">
    <!-- å¯¼èˆªèœå• -->
    <nav class="sidebar-nav">
        <ul class="nav-list">
            {% for nav in main_navs %}
            <li class="nav-item{% if request.path == nav.url %} active{% endif %}" data-filter="{{ nav.name }}">
                <a href="{{ nav.url }}" class="nav-link">
                    <span class="nav-text">{{ nav.icon }}{{ nav.name }}</span>
                </a>
            </li>
            {% endfor %}
        </ul>
    </nav>
    
    <!-- å­æ ‡ç­¾ -->
    {% if sub_navs %}
    <div class="category-tags">
        <ul class="tags-list">
            {% for sub_nav in sub_navs %}
            <li class="tag-item{% if active_sub_tag == sub_nav.name %} active{% endif %}" data-tag="{{ sub_nav.name }}">
                <a href="{{ sub_nav.url }}" class="tag-link">{{ sub_nav.name }}</a>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</aside>
```

### 2.2 æ›´æ–°ç°æœ‰æ¨¡æ¿

- æ›´æ–° `find_items.html` å’Œ `manage_categories.html`ï¼Œä½¿ç”¨ç»Ÿä¸€çš„ä¾§è¾¹æ æ¨¡æ¿ç‰‡æ®µ
- åˆ é™¤ç¡¬ç¼–ç çš„ä¾§è¾¹æ å†…å®¹

## 3. è§†å›¾è®¾è®¡

### 3.1 æ›´æ–°è§†å›¾å‡½æ•°

åœ¨ `views.py` ä¸­æ·»åŠ è·å–å¯¼èˆªæ•°æ®çš„é€»è¾‘ï¼š

```python
from .models import Navigation

@login_required
def find_items(request):
    # ç°æœ‰é€»è¾‘...
    
    # è·å–å¯¼èˆªæ•°æ®
    main_navs = Navigation.objects.filter(user=request.user, type='main').order_by('order')
    active_main = None
    for nav in main_navs:
        if request.path == nav.url:
            active_main = nav
            break
    
    sub_navs = []
    if active_main:
        sub_navs = active_main.children.filter(user=request.user).order_by('order')
    
    # ç°æœ‰é€»è¾‘...
    
    context.update({
        'main_navs': main_navs,
        'sub_navs': sub_navs,
        'active_sub_tag': request.GET.get('sub_tag', '')
    })
    
    return render(request, 'items/find_items.html', context)

@login_required
def manage_categories(request):
    # ç°æœ‰é€»è¾‘...
    
    # è·å–å¯¼èˆªæ•°æ®
    main_navs = Navigation.objects.filter(user=request.user, type='main').order_by('order')
    active_main = None
    for nav in main_navs:
        if request.path == nav.url:
            active_main = nav
            break
    
    sub_navs = []
    if active_main:
        sub_navs = active_main.children.filter(user=request.user).order_by('order')
    
    # ç°æœ‰é€»è¾‘...
    
    context.update({
        'main_navs': main_navs,
        'sub_navs': sub_navs,
        'active_sub_tag': request.GET.get('sub_tag', '')
    })
    
    return render(request, 'items/manage_categories.html', context)
```

### 3.2 æ·»åŠ å¯¼èˆªç®¡ç†è§†å›¾

æ·»åŠ è§†å›¾å‡½æ•°ç”¨äºç®¡ç†å¯¼èˆªï¼š

```python
@login_required
def manage_navigation(request):
    # å¯¼èˆªç®¡ç†é€»è¾‘...
    return render(request, 'items/manage_navigation.html', context)
```

## 4. æ•°æ®åˆå§‹åŒ–

### 4.1 åˆ›å»ºåˆå§‹å¯¼èˆªæ•°æ®

åˆ›å»ºä¸€ä¸ªæ•°æ®è¿ç§»æˆ–ç®¡ç†å‘½ä»¤ï¼Œåˆå§‹åŒ–é»˜è®¤çš„å¯¼èˆªæ•°æ®ï¼š

```python
# åˆ›å»ºé»˜è®¤å¯¼èˆªæ•°æ®
main_navs = [
    {'name': 'æŒ‰æˆ¿é—´æ‰¾', 'type': 'main', 'url': '/items/find/?filter=room', 'icon': 'ğŸ”', 'order': 1},
    {'name': 'æŒ‰åˆ†ç±»æ‰¾', 'type': 'main', 'url': '/items/find/?filter=category', 'icon': 'ğŸ“¦', 'order': 2},
    {'name': 'ç®¡ç†åˆ†ç±»', 'type': 'main', 'url': '/items/manage/', 'icon': 'âš™ï¸', 'order': 3},
]

for nav_data in main_navs:
    Navigation.objects.get_or_create(
        user=request.user,
        name=nav_data['name'],
        type=nav_data['type'],
        defaults={
            'url': nav_data['url'],
            'icon': nav_data['icon'],
            'order': nav_data['order'],
        }
    )

# åˆ›å»ºå­æ ‡ç­¾æ•°æ®
manage_nav = Navigation.objects.get(user=request.user, name='ç®¡ç†åˆ†ç±»', type='main')
sub_navs = [
    {'name': 'åˆ†ç±»ç®¡ç†', 'type': 'sub', 'url': '/items/manage/?sub_tag=åˆ†ç±»ç®¡ç†', 'icon': 'ğŸ“‹', 'order': 1, 'parent': manage_nav},
    {'name': 'æˆ¿é—´ç®¡ç†', 'type': 'sub', 'url': '/items/manage/?sub_tag=æˆ¿é—´ç®¡ç†', 'icon': 'ğŸ ', 'order': 2, 'parent': manage_nav},
]

for sub_data in sub_navs:
    Navigation.objects.get_or_create(
        user=request.user,
        name=sub_data['name'],
        type=sub_data['type'],
        parent=sub_data['parent'],
        defaults={
            'url': sub_data['url'],
            'icon': sub_data['icon'],
            'order': sub_data['order'],
        }
    )
```

## 5. äº¤äº’è®¾è®¡

### 5.1 ä¿æŒç°æœ‰äº¤äº’æ•ˆæœ

ç¡®ä¿ç»Ÿä¸€æ¨¡æ¿åçš„ä¾§è¾¹æ ä¿æŒåŸæœ‰çš„äº¤äº’æ•ˆæœï¼š
- ç‚¹å‡»ä¸»åˆ†ç±»åˆ‡æ¢é¡µé¢
- ç‚¹å‡»å­æ ‡ç­¾åˆ‡æ¢å†…å®¹
- æ¿€æ´»çŠ¶æ€é«˜äº®æ˜¾ç¤º

## 6. å®ç°æ­¥éª¤

1. åˆ›å»º `Navigation` æ¨¡å‹
2. è¿è¡Œæ•°æ®è¿ç§»
3. åˆ›å»ºç»Ÿä¸€
æ ‡å‡†ç»Ÿä¸€

## 4. æµ‹è¯•ä¸éƒ¨ç½²

## 7. æµ‹è¯•ä¸éƒ¨ç½²

1. åˆ›å»ºç»Ÿä¸€çš„ä¾§è¾¹æ æ¨¡æ¿ç‰‡æ®µ
2. æ›´æ–°è§†å›¾å‡½æ•°ï¼Œæ·»åŠ å¯¼èˆªæ•°æ®è·å–é€»è¾‘
3. æ›´æ–°ç°æœ‰æ¨¡æ¿ï¼Œä½¿ç”¨ç»Ÿä¸€çš„ä¾§è¾¹æ 
4. åˆå§‹åŒ–é»˜è®¤å¯¼èˆªæ•°æ®
5. æµ‹è¯•ä¾§è¾¹æ åŠŸèƒ½
6. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

## 8. é¢„æœŸæ•ˆæœ

- ä¾§è¾¹æ å†…å®¹ä»æ•°æ®åº“åŠ¨æ€è·å–
- å¤§åˆ†ç±»ä¸å­æ ‡ç­¾å»ºç«‹æ•°æ®å…³ç³»
- ä¿æŒåŸæœ‰çš„æ ·å¼ã€å¸ƒå±€å’Œäº¤äº’æ•ˆæœ
- å®ç°äº†ä¾§è¾¹æ çš„ç»Ÿä¸€ç®¡ç†
- æ”¯æŒåŠ¨æ€æ·»åŠ ã€ä¿®æ”¹å’Œåˆ é™¤å¯¼èˆªé¡¹
- æé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§