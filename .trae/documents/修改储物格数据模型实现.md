# 实现计划

## 1. 模型设计与修改

### 1.1 创建Room和Furniture模型
- 在`apps/items/models.py`中添加`Room`和`Furniture`模型
- `Room`模型包含`name`字段，用于存储房间名称（如主卧、次卧、书房）
- `Furniture`模型包含`name`字段，用于存储家具名称（如床头柜、书桌、衣柜）
- 两个模型都关联到用户，并设置唯一约束

### 1.2 修改Storage模型
- 将`room`和`furniture`字段从`CharField`改为外键关联
- 保留`storage_code`和`qr_code`字段，确保都不为空
- 更新`save()`方法，确保编号生成逻辑正确
- 编号格式：AA001，其中第一个字母代表房间，第二个字母代表家具，最后的3个数字代表家具的储物格编号
- 不同的房间的不同家具都从001开始编号

## 2. 视图和模板更新

### 2.1 更新deposit_storage视图
- 修改视图逻辑，处理外键关系
- 确保表单提交时能正确创建Room、Furniture和Storage实例

### 2.2 更新tag_view视图
- 修改储物格创建逻辑，处理外键关系
- 确保能正确从名称中提取房间和家具信息

### 2.3 更新模板
- 确保模板中的表单字段与新模型结构匹配
- 保持极简主义设计原则

## 3. 数据库迁移

### 3.1 生成迁移文件
- 运行`python manage.py makemigrations`生成新的迁移文件
- 确保迁移文件正确处理字段类型变更和外键关系

### 3.2 应用迁移
- 运行`python manage.py migrate`应用迁移
- 确保数据库结构正确更新

## 4. 测试

### 4.1 测试模型功能
- 测试自动编号生成功能
- 测试外键关系是否正常
- 测试QR码存储功能

### 4.2 测试视图功能
- 测试储物格录入功能
- 测试标签生成功能
- 测试关联功能

## 5. 项目结构更新

- 如果创建了新文件，更新`docs/project_structure.md`文档

## 实现原则

- 保持页面风格的延续性且符合极简主义设计原则
- 只做必要修改，其他内容保持不变
- 用最简单、最精简、性能最优的代码完成功能
- 确保所有核心字段都不为空
- 确保编号生成逻辑正确，不同的房间的不同家具都从001开始编号