# 物品编号、分类和位置问题修复

## 一、问题分析
1. **小米钢化杯无编号**：ID为1的小米钢化杯item_code为None，需要确保编号不能为空
2. **分类提取问题**：需要确保分类从数据库中提取，按照一级分类默认自动创建
3. **位置格式问题**：物品位置直接存储了储物格名称，与储物格的room、furniture、unit字段不对应

## 二、实现步骤

### 1. 修改Item模型，使item_code不能为空
- **文件**：`apps/items/models.py`
- **修改**：将item_code字段的null和blank属性设置为False，确保编号不能为空

### 2. 为无编号的小米钢化杯生成编号
- **文件**：创建临时脚本`generate_missing_codes.py`
- **功能**：为所有没有编号的物品生成唯一编号

### 3. 修复分类提取逻辑
- **文件**：`apps/items/views.py`
- **修改**：确保在所有物品创建路径中正确设置分类，从数据库中提取分类选项

### 4. 修复位置格式问题
- **文件**：`apps/items/models.py`
- **修改**：考虑添加外键关联或修改位置存储逻辑，确保位置与储物格的三个字段对应

### 5. 更新物品创建和关联逻辑
- **文件**：`apps/items/views.py`
- **修改**：确保在物品创建和与储物格关联时，位置格式正确

### 6. 测试修复效果
- **文件**：运行检查脚本验证修复效果

## 三、技术要点
1. **Django模型修改**：修改字段属性，确保数据完整性
2. **编号生成**：使用现有的generate_item_code函数为无编号物品生成编号
3. **位置格式**：确保位置按照room-furniture-unit格式存储，与储物格的三个字段对应
4. **分类管理**：确保分类从数据库中提取，支持一级分类自动创建

## 四、预期效果
1. 所有物品都有唯一编号，item_code字段不能为空
2. 分类从数据库中提取，按照一级分类默认自动创建
3. 物品位置按照房间-家具-储物格格式保存，与储物格的三个字段对应
4. 新创建的物品自动获得正确的编号、分类和位置格式

## 五、文件修改清单
- **`apps/items/models.py`**：修改Item模型，确保item_code不能为空
- **`apps/items/views.py`**：更新物品创建和关联逻辑，确保分类和位置格式正确
- **`generate_missing_codes.py`**：临时脚本，为无编号物品生成编号
- **`check_items.py`**：检查修复效果