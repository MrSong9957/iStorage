// 简化版二维码生成库
(function() {
    'use strict';
    
    function QRCode() {
        // 简化版二维码生成器
    }
    
    QRCode.toCanvas = function(container, text, options, callback) {
        // 创建一个简单的二维码生成器
        const canvas = document.createElement('canvas');
        canvas.width = options.width || 128;
        canvas.height = options.height || 128;
        const ctx = canvas.getContext('2d');
        
        // 清空画布
        ctx.fillStyle = options.color.light || '#ffffff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // 绘制简单的二维码样式
        ctx.fillStyle = options.color.dark || '#000000';
        
        // 绘制定位图案
        drawPositionPattern(ctx, 10, 10, options.color.dark, options.color.light);
        drawPositionPattern(ctx, canvas.width - 26, 10, options.color.dark, options.color.light);
        drawPositionPattern(ctx, 10, canvas.height - 26, options.color.dark, options.color.light);
        
        // 绘制数据区域（简化版，使用文字的ASCII码生成图案）
        const textData = text.split('').map(c => c.charCodeAt(0));
        let dataIndex = 0;
        
        for (let y = 0; y < canvas.height; y += 8) {
            for (let x = 0; x < canvas.width; x += 8) {
                // 跳过定位图案区域
                if ((x < 40 && y < 40) || (x > canvas.width - 40 && y < 40) || (x < 40 && y > canvas.height - 40)) {
                    continue;
                }
                
                // 使用文字数据生成图案
                const dataValue = textData[dataIndex % textData.length];
                if (dataValue % 2 === 0) {
                    ctx.fillRect(x, y, 6, 6);
                }
                dataIndex++;
            }
        }
        
        // 清除容器内容并添加二维码
        container.innerHTML = '';
        container.appendChild(canvas);
        
        if (callback) callback(null);
    };
    
    // 绘制二维码定位图案
    function drawPositionPattern(ctx, x, y, darkColor, lightColor) {
        // 外框
        ctx.fillStyle = darkColor;
        ctx.fillRect(x, y, 26, 26);
        // 内框
        ctx.fillStyle = lightColor;
        ctx.fillRect(x + 6, y + 6, 14, 14);
        // 中心点
        ctx.fillStyle = darkColor;
        ctx.fillRect(x + 10, y + 10, 6, 6);
    }
    
    // 暴露到全局
    window.QRCode = QRCode;
})();